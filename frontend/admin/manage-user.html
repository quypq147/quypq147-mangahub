<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>MangaCloud - Manage Users</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
    rel="stylesheet" />
  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
            "background-light": "#f8fafc",
            "background-dark": "#0f172a",
            "surface-light": "#ffffff",
            "surface-dark": "#1e293b",
          },
          fontFamily: {
            display: ["Inter", "sans-serif"],
          },
          borderRadius: {
            DEFAULT: "0.5rem",
          },
        },
      },
    };
  </script>
  <style type="text/tailwindcss">
    @layer base {
        body {
          font-family: "Inter", sans-serif;
        }
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 10px;
      }
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-slate-100 min-h-screen flex">
  <aside
    class="w-20 lg:w-64 border-r border-slate-200 dark:border-slate-800 bg-surface-light dark:bg-surface-dark flex flex-col transition-all duration-300 shrink-0">
    <div class="p-6 flex items-center gap-3">
      <div class="w-8 h-8 bg-primary rounded-lg flex items-center justify-center">
        <span class="material-symbols-outlined text-white text-xl">auto_stories</span>
      </div>
      <span class="font-bold text-xl hidden lg:block tracking-tight">MangaCloud</span>
    </div>
    <nav class="flex-1 px-4 py-4 space-y-2">
      <a class="flex items-center gap-4 px-3 py-3 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors group"
        href="#">
        <span class="material-symbols-outlined group-hover:text-primary transition-colors">dashboard</span>
        <span class="font-medium hidden lg:block">Dashboard</span>
      </a>
      <a class="flex items-center gap-4 px-3 py-3 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors group"
        href="#">
        <span class="material-symbols-outlined group-hover:text-primary transition-colors">analytics</span>
        <span class="font-medium hidden lg:block">Analytics</span>
      </a>
      <a class="flex items-center gap-4 px-3 py-3 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors group"
        href="#">
        <span class="material-symbols-outlined group-hover:text-primary transition-colors">library_books</span>
        <span class="font-medium hidden lg:block">Manage Manga</span>
      </a>
      <a class="flex items-center gap-4 px-3 py-3 text-primary bg-primary/10 rounded-xl transition-colors" href="#">
        <span class="material-symbols-outlined">group</span>
        <span class="font-medium hidden lg:block">Manage Users</span>
      </a>
      <a class="flex items-center gap-4 px-3 py-3 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors group"
        href="#">
        <span class="material-symbols-outlined group-hover:text-primary transition-colors">forum</span>
        <span class="font-medium hidden lg:block">Forum Moderation</span>
      </a>
      <a class="flex items-center gap-4 px-3 py-3 text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors group relative"
        href="#">
        <span class="material-symbols-outlined group-hover:text-primary transition-colors">cloud_upload</span>
        <span class="font-medium hidden lg:block">Upload Requests</span>
        <span
          class="absolute right-3 top-1/2 -translate-y-1/2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden lg:block">12</span>
      </a>
    </nav>
    <div class="p-4 border-t border-slate-200 dark:border-slate-800">
      <button
        class="flex items-center gap-4 px-3 py-3 w-full text-slate-500 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-xl transition-colors"
        onclick="document.documentElement.classList.toggle('dark')">
        <span class="material-symbols-outlined dark:hidden">dark_mode</span>
        <span class="material-symbols-outlined hidden dark:block">light_mode</span>
        <span class="font-medium hidden lg:block">Appearance</span>
      </button>
      <div class="flex items-center gap-3 mt-4 px-3">
        <img alt="Admin profile" class="w-10 h-10 rounded-full object-cover"
          src="https://lh3.googleusercontent.com/aida-public/AB6AXuACmy-xD2tdo03An3MHuZbHIMxSTSc2uBko0mn1PvVR6x796s7s_ThyCqZnQu-qfYr2GtGoxgwCOnj3hPkwqHE1dHDEi_vGuvWaNXL6mCAiusOlKdc1EUwyg3TxKy70KP7YgiqAyvhEZ7mtyHP7-Q5ntcmDcJFYK_dxsgkPv6QqxfVxdRBX31ndMwrKKBXIRZ3slkRHJ8Hu9KpBc5t6spwAu7dfsLpx_y6LQUBrb8Dmq8QYOlEsqt40Wy4OVzoQK2bGZwMFATQv1lU" />
        <div class="hidden lg:block overflow-hidden">
          <p class="text-sm font-semibold truncate">Admin User</p>
          <p class="text-xs text-slate-500 truncate">Super Admin</p>
        </div>
      </div>
    </div>
  </aside>
  <main class="flex-1 overflow-y-auto custom-scrollbar p-6 lg:p-10">
    <header class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
      <div>
        <h1 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white">
          Quản lý Danh sách Người dùng
        </h1>
        <p class="text-slate-500 dark:text-slate-400 mt-1">
          Xem xét, giám sát và quản lý vai trò cho tất cả thành viên đã đăng ký.
        </p>
      </div>
      <div class="flex items-center gap-3">
        <button
          class="bg-surface-light dark:bg-surface-dark border border-slate-200 dark:border-slate-700 px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
          <span class="material-symbols-outlined text-lg">download</span>
          Xuất danh sách
        </button>
        <button class="bg-primary text-white px-4 py-2 rounded-lg font-medium flex items-center gap-2 hover:opacity-90 transition-opacity">
          <span class="material-symbols-outlined text-lg">person_add</span>
          Mời người dùng
        </button>
      </div>
    </header>
    <div
      class="bg-surface-light dark:bg-surface-dark rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm overflow-hidden flex flex-col">
      <div
        class="p-6 border-b border-slate-200 dark:border-slate-800 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-4 w-full md:w-auto">
          <div class="relative w-full md:w-80">
            <span
              class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">search</span>
            <input
              class="w-full pl-10 pr-4 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all text-sm"
              placeholder="Tìm kiếm người dùng theo tên hoặc email..." type="text" />
          </div>
          <button
            class="p-2 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined text-slate-500">filter_list</span>
          </button>
        </div>
        <div class="flex items-center gap-2 w-full md:w-auto">
          <span class="text-sm text-slate-500 mr-2 hidden sm:inline"><span id="selected-count">2</span> người dùng đã chọn</span>
          <select
            class="bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 text-sm rounded-lg focus:ring-primary focus:border-primary block p-2">
            <option selected="">Hành động hàng loạt</option>
            <option value="role_contributor">Đặt làm Cộng tác viên</option>
            <option value="role_moderator">Đặt làm Kiểm duyệt viên</option>
            <option value="ban">Cấm người đã chọn</option>
            <option value="delete">Xóa người đã chọn</option>
          </select>
          <button class="bg-slate-900 dark:bg-slate-100 text-white dark:text-slate-900 px-4 py-2 rounded-lg font-bold text-xs uppercase tracking-wider hover:opacity-90 transition-opacity">
            Áp dụng
          </button>
        </div>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-left">
          <thead
            class="bg-slate-50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 text-xs uppercase font-semibold">
            <tr>
              <th class="px-6 py-4 w-10">
                <input class="w-4 h-4 rounded border-slate-300 dark:border-slate-600 bg-transparent text-primary focus:ring-primary"
                    type="checkbox" />
              </th>
              <th class="px-6 py-4">Tên người dùng</th>
              <th class="px-6 py-4">Email</th>
              <th class="px-6 py-4">Vai trò</th>
              <th class="px-6 py-4">Trạng thái</th>
              <th class="px-6 py-4">Lần hoạt động</th>
              <th class="px-6 py-4 text-right">Thao tác</th>
            </tr>
          </thead>
          <tbody id="users-table-body" class="divide-y divide-slate-100 dark:divide-slate-800"></tbody>
        </table>
      </div>
      <div class="p-6 border-t border-slate-200 dark:border-slate-800 flex items-center justify-between">
        <span class="text-sm text-slate-500">Showing 1 to 4 of 42,892 users</span>
        <div class="flex items-center gap-2">
          <button
            class="p-2 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 disabled:opacity-50 transition-colors"
            disabled="">
            <span class="material-symbols-outlined text-lg">chevron_left</span>
          </button>
          <button class="w-8 h-8 rounded-lg bg-primary text-white font-bold text-xs">
            1
          </button>
          <button class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium text-xs">
            2
          </button>
          <button class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium text-xs">
            3
          </button>
          <span class="px-2 text-slate-400">...</span>
          <button class="w-8 h-8 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 font-medium text-xs">
            1072
          </button>
          <button
            class="p-2 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors">
            <span class="material-symbols-outlined text-lg">chevron_right</span>
          </button>
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mt-10">
      <div
        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
        <h3 class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
          Tổng người dùng
        </h3>
        <div class="flex items-center justify-between">
          <span class="text-2xl font-bold">42,892</span>
          <span class="text-emerald-500 text-xs font-medium">+2.4k tháng này</span>
        </div>
      </div>
      <div
        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
        <h3 class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
          Đang hoạt động
        </h3>
        <div class="flex items-center justify-between">
          <span class="text-2xl font-bold">1,429</span>
          <div class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
        </div>
      </div>
      <div
        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
        <h3 class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
          Bị cấm hôm nay
        </h3>
        <div class="flex items-center justify-between">
          <span class="text-2xl font-bold">12</span>
          <span class="text-red-500 text-xs font-medium">Làn sóng spam</span>
        </div>
      </div>
      <div
        class="bg-surface-light dark:bg-surface-dark p-5 rounded-2xl border border-slate-200 dark:border-slate-800 shadow-sm">
        <h3 class="text-slate-500 dark:text-slate-400 text-xs font-bold uppercase tracking-wider mb-2">
          Nhân viên chờ duyệt
        </h3>
        <div class="flex items-center justify-between">
          <span class="text-2xl font-bold">8</span>
          <span class="text-amber-500 text-xs font-medium">Cần xem xét</span>
        </div>
      </div>
    </div>
    <footer
      class="mt-10 p-6 bg-slate-900 dark:bg-slate-800/50 rounded-2xl text-white flex flex-col md:flex-row items-center justify-between gap-4">
      <div class="flex items-center gap-4 text-center md:text-left">
        <div class="p-2 bg-primary/20 rounded-lg text-primary">
          <span class="material-symbols-outlined">security</span>
        </div>
        <div>
          <h4 class="font-bold">Kiểm toán Quyền riêng tư & Bảo mật</h4>
          <p class="text-sm text-slate-400">
            Xác minh dữ liệu người dùng hàng tháng được lên lịch vào thứ Sáu. Vui lòng đảm bảo tất cả nhật ký kiểm duyệt được cập nhật.
          </p>
        </div>
      </div>
      <button class="px-6 py-2 bg-primary text-white font-bold rounded-lg hover:opacity-90 transition-opacity shrink-0">
        Xem nhật ký kiểm toán
      </button>
    </footer>
  </main>
</body>
<script>
  const API_BASE = "http://localhost:3000/api";
  const token = localStorage.getItem("token");

  async function loadUsers() {
    if (!token) {
      window.location.href = "../sign-in/index.html";
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/user/all`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const users = await res.json();

      document.getElementById("users-table-body").innerHTML = users.map(user => `
        <tr class="hover:bg-slate-50/50 dark:hover:bg-slate-800/30 transition-colors">
          <td class="px-6 py-4"><input type="checkbox" class="rounded"></td>
          <td class="px-6 py-4 font-medium">${user.username}</td>
          <td class="px-6 py-4 text-sm text-slate-500">${user.email}</td>
          <td class="px-6 py-4">
            <select onchange="updateRole('${user._id}', this.value)"
                    class="bg-transparent text-xs font-bold border rounded-full px-2 py-1">
              <option value="user">Thành viên</option>
              <option value="contributor">Cộng tác viên</option>
              <option value="moderator">Kiểm duyệt viên</option>
              <option value="admin">Quản trị viên</option>
            </select>
          </td>
          <td class="px-6 py-4 text-right">
            <button onclick="deleteUser('${user._id}')" class="text-slate-400 hover:text-red-500">
              <span class="material-symbols-outlined">delete</span>
            </button>
          </td>
        </tr>
      `).join("");
    } catch (e) {
      console.error(e);
    }
  }

  async function updateRole(userId, role) {
    await fetch(`${API_BASE}/user/role`, {
        method: "PUT",
        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
        body: JSON.stringify({ userId, role })
    });
    alert("Cập nhật thành công!");
  }

  document.addEventListener("DOMContentLoaded", loadUsers);
</script>

</html>